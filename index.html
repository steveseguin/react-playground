<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>React Playground</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/3.4.1/tailwind.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/jsx/jsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.2/Recharts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    
    <style>
        /* Keep existing styles */
        [Previous styles remain exactly the same...]
    </style>
    
    <script>
        window.componentsUI = {
            /* Keep existing component definitions */
            [Previous componentsUI definitions remain exactly the same...]
        };
    </script>
</head>
<body>
    <div class="header">
        <button onclick="runCode()">Run</button>
        <div class="toggle-switch">
            <input type="radio" id="codeView" name="view" value="code" checked>
            <label for="codeView">Code</label>
            <input type="radio" id="previewView" name="view" value="preview">
            <label for="previewView">Preview</label>
            <span class="slider"></span>
        </div>
    </div>
    <div class="content">
        <div id="code-container" class="code-container">
            <textarea id="code">// Custom components are available under componentsUI
const { Card, CardContent, Button, Input } = window.componentsUI;

function App() {
  const [count, setCount] = React.useState(0);
  
  return (
    <Card>
      <CardContent>
        <h1 className="text-xl font-bold mb-4">Hello React!</h1>
        <Button 
          onClick={() => setCount(count + 1)}
          className="bg-blue-500 hover:bg-blue-600"
        >
          Count: {count}
        </Button>
      </CardContent>
    </Card>
  );
}</textarea>
        </div>
        <div id="preview" class="preview hidden"></div>
    </div>
    <div id="error" class="error"></div>

    <script>
        let isShowingPreview = false;
        const preview = document.getElementById('preview');
        const codeContainer = document.getElementById('code-container');
        const errorDisplay = document.getElementById('error');

        const editor = CodeMirror.fromTextArea(document.getElementById('code'), {
            mode: 'jsx',
            theme: 'dracula',
            lineNumbers: true,
            matchBrackets: true,
            autoCloseBrackets: true,
            indentUnit: 2,
            tabSize: 2,
            lineWrapping: true,
            autofocus: true,
            dragDrop: false,
            scrollbarStyle: null,
            viewportMargin: Infinity,
            extraKeys: {
                'Tab': (cm) => {
                    if (cm.somethingSelected()) {
                        cm.indentSelection('add');
                    } else {
                        cm.replaceSelection('  ', 'end');
                    }
                }
            }
        });

        editor.on('paste', (cm, e) => {
            if (e.clipboardData) {
                e.preventDefault();
                const text = e.clipboardData.getData('text/plain');
                cm.replaceSelection(text);
            }
        });

        editor.on('drop', (cm, e) => {
            e.preventDefault();
            return false;
        });

        document.querySelectorAll('.toggle-switch input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                isShowingPreview = this.value === 'preview';
                preview.classList.toggle('hidden', !isShowingPreview);
                codeContainer.classList.toggle('hidden', isShowingPreview);
                if (isShowingPreview) runCode();
            });
        });

        function runCode() {
            const code = editor.getValue();
            errorDisplay.textContent = '';
            errorDisplay.classList.remove('visible');
            preview.innerHTML = '<div id="root"></div>';
            
            try {
                const transformedCode = Babel.transform(code, {
                    presets: ['react'],
                    filename: 'app.jsx'
                }).code;

                const scriptElement = document.createElement('script');
                scriptElement.type = 'text/javascript';
                scriptElement.textContent = `
                    ${transformedCode}
                    const root = ReactDOM.createRoot(document.getElementById('root'));
                    root.render(React.createElement(App));
                `;

                document.body.appendChild(scriptElement);
                setTimeout(() => scriptElement.remove(), 0);
            } catch (error) {
                errorDisplay.textContent = error.toString();
                errorDisplay.classList.add('visible');
            }
        }
    </script>
</body>
</html>
